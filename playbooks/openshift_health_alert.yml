---
- name: OpenShift Health Alert
  hosts: localhost
  gather_facts: no

  vars:
    email_to: vvidhya@redhat.com
    email_from: vidyavece@gmail.com
    smtp_host: smtp.gmail.com
    smtp_port: 587

  tasks:
    - name: Send OpenShift health alert email
      mail:
        host: "{{ smtp_host }}"
        port: "{{ smtp_port }}"
        secure: starttls
        username: "{{ lookup('env', 'GMAIL_USERNAME') }}"
        password: "{{ lookup('env', 'GMAIL_APP_PASSWORD') }}"
        to: "{{ email_to }}"
        from: "{{ email_from }}"
        subject: "ðŸš¨ OpenShift Health Alert"
        body: |
          OpenShift Health Issue Detected

          Check  : {{ check | default('unknown') }}
          Status : {{ status | default('failed') }}
          Time   : {{ ansible_date_time.iso8601 }}

          This alert was automatically triggered by Ansible EDA.
