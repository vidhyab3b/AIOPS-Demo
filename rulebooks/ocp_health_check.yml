---
name: pod-failure-alert
description: Alert when any pod is not running
hosts: localhost
vars:
  email_template_name: "OpenShift Health Alert" 

rules:
  - name: pod-not-running
    event: "k8s.pod.status"
    match:
      # Trigger when pod status is NOT Running
      "{{ event.object.status.phase != 'Running' }}"
    actions:
      - name: trigger-email-template
        ansible.builtin.include_role:
          name: trigger-job-template
        vars:
          template_name: "{{ email_template_name }}"
          namespace: "{{ event.object.metadata.namespace }}"
          pod_name: "{{ event.object.metadata.name }}"
          pod_status: "{{ event.object.status.phase }}"
